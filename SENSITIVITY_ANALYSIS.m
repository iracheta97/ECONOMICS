% This program calculate the Joule losses of underwater cables
% in a off-shore Wind Farm

% Created by: Dr. Reynaldo Iracheta Cortez
% Date: 2/April/2019

clc;
clear;

% Wind Turbine Data:
load('WT_SANCHEZ');              % kW
% Annual Energy Production (AEP)-(kWh)
load('POWER');           % kW
PGROSS=P.GROSS;          % kWh Gross Energy Production,
PNET=P.NET;              % kWh Net Energy Production,
PWAKE=P.WAKE;            % Energy Loss due to Wake Effect,
PLOSS=P.LOSS;            % Energy Loss due to Joule Losses in Cables.

% Wind Farm Data:
load('WFARM');           %

% Electricity Prices:
load('EPRICE');         % USD/kW
EPR=(PR1);        %

% Load:
LOAD=0*EPR;             % kW
%--------------------------------------------------------------------------
% Economic Data:
%--------------------------------------------------------------------------
% Wind Production:
% Capital Cost:
CC=1600:100:3500;       % USD/kW
% Operation & Maintenance:
% OM=2:0.1:3;            % Percentage
OM=2;
% Project Life:
PL=20;                 % Years
% Real interest:
R=10:-1:1;                % Percentage
% Simulation Case:
% 1: Only Power Network
% 2: Power Network + 1 Turbine
CASE=15;
% Cash Flow: (1: Nominal; 2: Discounted):
CF=2;
% Summary Costs: (1:Present Net, 2: Annualized);
SC=2;
% Categorize: (1: By Component, 2: By Cost Type:
CAT=1;
% Structure Data:
ED=[];
ED=setfield(ED,'CC',CC);                    % Capital Cost (USD/kW)
ED=setfield(ED,'OM',OM);                    % O&M Cost (USD/kW),
ED=setfield(ED,'PL',PL);                    % Project Life (years),
ED=setfield(ED,'R',R);                      % Real Interest (%),
ED=setfield(ED,'CASE',CASE);                % Simulation Case,
ED=setfield(ED,'CF',CF);                    % Cash Flow (USD) {1-2},
ED=setfield(ED,'SC',SC);                 	% Summary Cost (USD) {1-2},
ED=setfield(ED,'CAT',CAT);                 	% Categoriza {1-2},

% Economic Analysis with Annual Gross Power:
% Considerig only the grid,
% EPR: Price of electricity (USD/kW)
% LOAD: Load Consumption (kW)
LCC=length(CC);
LOM=length(R);
for i=1:LOM
    for j=1:LCC    
        ED.CC=CC(j);                         % Capital Cost (USD/kW)
        %ED.OM=OM(j);                         % O&M Cost (USD/kW),
        ED.R=R(i);                           % Real Interest (%),
        [COST,WP,DF,FCASH,CRF,POWER] = ECONOMY(WF,WT,PGROSS,EPR,LOAD,ED); %USD
        NPC(i,j)=COST.NPC(CASE);
        COE(i,j)=COST.COE(CASE);
    end
end
% Breakdown of Costs:
[OPT REP TOTAL ECO] = EREPORT(WF,COST,FCASH,POWER,LOAD,CRF,ED);
% Variables used in Sensitivity Analysis:
%--------------------------------------------------------------------------
% NPC:
%--------------------------------------------------------------------------
figure(1)
%colormap Hot;
colormap([1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0]);
%colormap Summer;
%colormap default;
%colormap([1,0,0; 1,1,1])
%colormap(flipud(colormap))
y=surf(CC, R, NPC/1E6,'FaceLighting','gouraud','LineWidth',0.5);%view(70,20);
view([-15.44 23.2]);
set(gca,'fontname','tahoma','fontsize',15,'fontweight','light','LineWidth',2);
% Create colorbar
colorbar('eastoutside');
%--------------------------------------------------------------------------
% COE:
%--------------------------------------------------------------------------
figure(2)
colormap Hot;
%colormap([1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0]);
%colormap([1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0]);
colormap([1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0]);

%colormap Summer;
%colormap default;
%colormap([1,0,0; 1,1,1])
%colormap(flipud(colormap))

% Create axes
y = axes('Position',[0.13 0.11 0.685873393087523 0.855000726609015]);
surf(CC, R, COE,'FaceLighting','gouraud','LineWidth',0.5);
view([-18 27.04]);
set(gca,'fontname','tahoma','fontsize',15,'fontweight','light','LineWidth',2);
xlabel(['Costo Capital (USD/kW)'],'fontsize',18,'fontname','normal','FontAngle','normal','fontweight','normal','rotation',90');
% Create colorbar:
colorbar('peer',y,'Position',...
    [0.858587168072331 0.17857142857143 0.0476190476190477 0.815000000000002]);
